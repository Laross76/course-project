# План автоматизации тестирования сервиса покупки тура.

## 1. Цель плана
Цель данного плана — описать процесс автоматизации тестирования веб-сервиса покупки тура. Сервис позволяет пользователям приобретать туры с использованием двух методов оплаты: дебетовой картой (через Payment Gate) и в кредит (через Credit Gate). Автоматизация фокусируется на функциональном тестировании, включая взаимодействие с внешними банковскими сервисами, валидацию форм, проверку базы данных (MySQL) и обработку ошибок. Тесты должны обеспечивать покрытие основных сценариев, выявлять регрессии и интегрироваться в CI/CD для регулярного выполнения.

## 1.2. Область тестирования
- Функциональность: Проверка успешных и неудачных покупок, валидация полей формы.
- Интеграция: Взаимодействие с Payment Gate и Credit Gate (банковские сервисы).
- База данных: Проверка статуса платежей в MySQL (поля: payment_id, status, payment_method, amount; данные карт не хранятся).
- UI/UX: Валидация форм оплаты, отображение сообщений об успехе/ошибке.
- Отрицательные сценарии: Отказы карт, невалидные данные.
- Не в области: Производительность, безопасность (кроме базовой валидации), ручное тестирование (фокус на автоматизации).
  
Тестовые данные: Используются APPROVED (успешные) и DECLINED (отказы) карты, предоставленные для тестирования. Сумма тура фиксирована (45000 RUB).

## 1.3. Предположения и ограничения
- Доступ к тестовым банковским сервисам (Payment Gate, Credit Gate) и MySQL БД.
- UI формы оплаты стабилен (риск изменений).
- Тесты запускаются в изолированной среде (staging).
- Ограничение: Автоматизация начинается с одного метода оплаты (дебетовая карта), затем расширяется на кредит.

## 2. Стратегия тестирования
## 2.1. Типы тестов
- Функциональные: UI-тесты форм, API-тесты взаимодействия с банками, DB-тесты статуса.
- Интеграционные: Проверка потока от формы до БД.
- Негативные: Валидация ошибок.
- Регрессионные: Повторные запуски после изменений.

## 2.2. Приоритезация сценариев
- Высокий приоритет: Happy path (успешные покупки).
- Средний приоритет: Негативные сценарии (отказы карт).
- Низкий приоритет: Валидация полей (эквивалентное разбиение и граничные значения).

## 2.3. Критерии завершения
- Покрытие основных сценариев (минимум 80% функциональности).
- Успешный запуск в CI/CD.
- Отчеты Allure без критических багов.
  
## 3. Тестовые сценарии и кейсы
Тестовые сценарии структурированы как чек-лист. Каждый кейс включает название, входные данные, ожидаемые результаты и примечания. Сценарии адаптированы для обеих форм оплаты (карта и кредит), но фокус на дебетовой карте. Методы: эквивалентное разбиение (классы валидных/невалидных значений) и граничные значения (минимум/максимум).

## Общие валидные тестовые данные (для позитивных и базовых негативных сценариев)
Эти данные используются во всех сценариях, где требуется успешная операция. Они соответствуют картам APPROVED (успешные) и DECLINED (отказы). Общая характеристика: данные генерируются на основе реальных шаблонов Visa/Mastercard (номер — 16 цифр, владелец — латиница, срок — будущая дата, CVC — 3 цифры). Конкретные примеры:

- Номер карты APPROVED: 1111 2222 3333 4444.
- Владелец: IVAN IVANOV.
- Месяц срока: 12.
- Год срока: 25 (текущий год + 1).
- CVC: 123.
- Сумма тура: 45000 RUB.
- Для кредита: те же данные, плюс лимит 100000 RUB (одобрен).
  
## Позитивные сценарии (Happy Path)
Эти сценарии проверяют успешное приобретение тура. Включают проверки в БД: статус = "APPROVED", payment_method = "CARD" или "CREDIT", amount = 45000, без хранения данных карты.

## 1.Успешная покупка тура по дебетовой карте (APPROVED)
- Входные данные: Валидные данные (как выше).
- Ожидаемые результаты: Тур куплен, UI: сообщение "Покупка успешна". БД: новая запись с status = "APPROVED", payment_method = "CARD".
- Примечания: Тестируется Payment Gate.
  
## 2.Успешная покупка тура в кредит (APPROVED)
- Входные данные: Валидные данные (как выше).
- Ожидаемые результаты: Тур куплен, UI: сообщение "Кредит одобрен". БД: новая запись с status = "APPROVED", payment_method = "CREDIT".
- Примечания: Тестируется Credit Gate.
  
## Негативные сценарии (Отклонённая карта)
Эти сценарии проверяют отказы. Покупка не совершается. БД: status = "DECLINED", payment_method = "CARD" или "CREDIT".

## 1.Отказ в покупке тура по дебетовой карте (DECLINED)
- Входные данные: Валидный шаблон, номер DECLINED: 5555 6666 7777 8888.
- Ожидаемые результаты: Тур не куплен, UI: "Карта отклонена". БД: новая запись с status = "DECLINED", payment_method = "CARD".
- Примечания: Тестируется Payment Gate.
 
## 2.Отказ в покупке тура в кредит (DECLINED)
- Входные данные: Валидный шаблон, номер DECLINED: 5555 6666 7777 8888.
- Ожидаемые результаты: Тур не куплен, UI: "Кредит отклонен". БД: новая запись с status = "DECLINED", payment_method = "CREDIT".
- Примечания: Тестируется Credit Gate.
  
## Негативные сценарии (Валидация полей формы)
Эти сценарии проверяют невалидные данные по каждому полю (по очереди). Методы: эквивалентное разбиение и граничные значения. Ожидания: Форма не отправляется, UI: ошибка валидации, БД: нет записи (или status = "FAILED" при попытке).

## 1.Валидация поля "Номер карты" (невалидный номер)
- Входные данные: Общая характеристика — невалидный формат (не 16 цифр, буквы/спецсимволы, не из тестового набора). Примеры: "123456789" (короткий), "11112222333344445555" (длинный), "abcd efgh ijkl mnop" (буквы), "1111-2222-3333-4444" (спецсимволы), "9999 8888 7777 6666" (не из набора). Остальные поля валидны.
- Ожидаемые результаты: Форма не отправляется, UI: "Неверный номер карты". БД: нет записи.
- Примечания: Эквивалентное разбиение по длине (менее 16, более 16) и типу символов. Граничные значения: 15 и 17 цифр.
  
## 2.Валидация поля "Владелец" (невалидное имя)
- Входные данные: Общая характеристика — не латиница, спецсимволы, цифры, пустое или слишком длинное (>30 символов). Примеры: "Иван Иванов" (кириллица), "Ivan@Ivanov" (спецсимволы), "12345" (цифры), "" (пустое), "Very Long Name That Exceeds Normal Limits For Cardholder" (длинное). Остальные поля валидны.
- Ожидаемые результаты: Форма не отправляется, UI: "Неверное имя владельца". БД: нет записи.
- Примечания: Эквивалентное разбиение по алфавиту и длине. Граничные значения: 0 и 31 символов.
  
## 3.Валидация поля "Месяц срока" (невалидный месяц)
- Входные данные: Общая характеристика — не в диапазоне 01-12, буквы/спецсимволы, пустое. Примеры: "13" (больше 12), "00" (меньше 01), "ab" (буквы), "" (пустое), "1" (одна цифра). Остальные поля валидны.
- Ожидаемые результаты: Форма не отправляется, UI: "Неверный месяц срока". БД: нет записи.
- Примечания: Эквивалентное разбиение по диапазону. Граничные значения: 00 и 13.
  
## 4.Валидация поля "Год срока" (невалидный год)
- Входные данные: Общая характеристика — прошедший год, слишком далёкий (>10 лет), буквы/спецсимволы, пустое. Примеры: "20" (прошедший), "35" (далёкий), "ab" (буквы), "" (пустое), "2" (одна цифра). Остальные поля валидны.
- Ожидаемые результаты: Форма не отправляется, UI: "Неверный год срока". БД: нет записи.
- Примечания: Эквивалентное разбиение по времени. Граничные значения: текущий год - 1 и текущий год + 10.
  
## 5.Валидация поля "CVC" (невалидный CVC)
- Входные данные: Общая характеристика — не 3 цифры, буквы/спецсимволы, пустое. Примеры: "12" (короткий), "1234" (длинный), "abc" (буквы), "" (пустое), "12a" (смешанный). Остальные поля валидны.
- Ожидаемые результаты: Форма не отправляется, UI: "Неверный CVC". БД: нет записи.
- Примечания: Эквивалентное разбиение по длине. Граничные значения: 2 и 4 цифры.
  
## 6.Валидация пустой формы (все поля пустые)
- Входные данные: Все поля пустые ("").
- Ожидаемые результаты: Форма не отправляется, UI: ошибки по всем полям. БД: нет записи.
- Примечания: Комплексный негативный сценарий.
  
## Инструменты и технологии
- Язык программирования: Python (рекомендуется версия 3.8+ для совместимости с библиотеками).
- Фреймворки тестирования: pytest для управления тестами, фикстур и параметризации (легче и гибче, чем JUnit/TestNG в Python-экосистеме).
- UI-автоматизация: Selenium (с WebDriver) для взаимодействия с веб-формами (стандартный выбор для Python; можно добавить selenium-stealth для обхода анти-бот-защиты, если потребуется).
- API-тестирование: requests (с дополнительными библиотеками вроде requests-mock для моков) для проверки запросов к Payment Gate/Credit Gate (простой и мощный HTTP-клиент, заменяет RestAssured).
- База данных: mysql-connector-python для прямых запросов в MySQL БД (проверка статуса платежей).
- Отчетность: Allure с pytest-плагином (pytest-allure-adaptor) для генерации отчетов с скриншотами, логами и историей тестов.
- Версионный контроль: GitHub для хранения кода тестов.
- CI/CD: Jenkins/GitLab CI для автоматического запуска тестов (ежедневно или по коммитам).
- Окружение: Docker для контейнеризации тестов, браузеры Chrome/Firefox (с chromedriver/geckodriver).
  
## Риски и смягчение
- Изменения UI: Мониторинг селекторов; использовать стабильные локаторы.
- Нестабильность банковских сервисов: Мокировать ответы для изоляции.
- Доступ к логам/БД: Обеспечить разрешения; использовать тестовую БД.
- Длительное время выполнения: Оптимизировать тесты, параллельные запуски.
- Внешние зависимости: Тестировать в staging-среде с симуляцией.
  
## Оценка усилий и ресурсов
- Анализ и планирование: 5 часов.
- Написание тестов: 15 часов (по 2-3 часа на сценарий).
- Отладка и интеграция: 3 часа.
- Отчеты и документация: 2 часа.
- Итого: ~25 часов.
- Ресурсы: 1 QA-инженер (автоматизатор), доступ к инструментам.
  
## Процесс выполнения и отчетность
- Разработка: Написать тесты в GitHub-репозитории (публичный для материалов).
- Запуск: В CI/CD, с Allure-отчетами (успех/провал, покрытие).
- Мониторинг: Еженедельные ревью багов, обновление тестов при изменениях.
- Завершение: После успешного прогона и покрытия критериев.